
Deploy requirements:
#####################

- Install mongo (with full text search).  If using version 2.4 on a numa
  machine, then run like this: 

$> numactl --interleave=all mongod --dbpath data/db/ --setParameter textSearchEnabled=true 

make sure data/db exists in the current directory

- Install python3. It is easy to do this in userspace

- Create a virtualenv with python3

$> sudo apt-get install python-virtualenv
$> virtualenv -p /usr/bin/python3.4 <name-venv>

- Install math libraries for highest performance

$> sudo apt-get install gfortran libopenblas-dev liblapack-dev

- Install all requirements. There are some version problems, iterate a few times
  removing hard constraints on versions. When a system wide dependency for
  scipy, scikit-learn or numpy exists, try to leverage it.

Some of the additional packages asked (in a ubuntu machine):

$> sudo apt-get install lib32ncurses5-dev
may need to install scipy individually first

WEB:
##
Install the web server, uwsgi and uwsgi-plugin-python (system wide):

$> deactivate
$> sudo apt-get install nginx uwsgi uwsgi-plugin-python

use this command to restart nginx whenever a configuration changes:

$> sudo /etc/init.d/nginx restart

Create nginx folders and delete default config:

$> sudo mkdir /var/www/aurum
$> sudo chown -R ra:ra /var/www/aurum (change ra for your user)
$> sudo rm /etc/nginx/sites-enabled/default

Move the file webserverconfig/aurum.conf to
/var/www/aurum/aurum.conf

then copy webgui (static files) to /var/www/aurum/static

$> cp -r webgui/ /var/www/aurum/static/

and then symlink the file to nginx configuration directory:

$> sudo ln -s /var/www/aurum/aurum.conf /etc/nginx/conf.d/

Move the file webserverconfig/uwsgi.ini to 
/var/www/aurum/uwsgi.ini

Create files for uwsgi logs:

$> sudo mkdir -p /var/log/uwsgi
$> sudo chown -R ra:ra /var/log/uwsgi (change ra for your user)

Test that uwsgi works, i.e., that nginx can connect to uwsgi:

$> uwsgi --ini /var/www/aurum/uwsgi.ini

Make uwsgi run as a daemon:

1. move webserver/uwsgi.conf to /etc/init/
2. create these:

$> sudo mkdir /etc/uwsgi && sudo mkdir /etc/uwsgi/vassals
$> sudo ln -s /var/www/aurum/aurum.ini /etc/uwsgi/vassals

make www-data user to own these:

$> sudo chown -R www-data:www-data /var/www/aurum/
$> sudo chown -R www-data:www-data /var/log/uwsgi/
$> sudo chmod 777 /var/log/uwsgi/aurum.log

Different loading techniques:
#############################

- dataloader is a single threaded impl build_idx_coordinator is a multi-thread
  multi machine impl

- ddworker is a simple worker in charge of computing n^2 pairs for similarity
  and overlap, it is coordinated by build_idx_coordinator

- fullworker is a worker in charge of: loading, computing signature,
  communicating to coordinator

Start load:
#########

workers:
celery -A fullworker worker --loglevel=INFO --concurrency 1 -n worker1 -Q w1

master:
python indexer.py --mode ALL --input csvfiles ~/Desktop/slicemitdwh/ --dataset fakeagain --workers w1

